<!DOCTYPE html>
  
  
  
  
   <html class="no-js"> 

  <head lang="en-us">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1,maximum-scale=1">
    <meta http-equiv="X-UA-Compatible" content="IE=10" />
    <title>wrk performance test - Undertow Server - The fastest Java API Framework</title>
    <meta name="generator" content="Hugo 0.17" />

    
    <meta name="description" content="Undertow Server Docs">
    
    <link rel="canonical" href="https://networknt.github.io/undertow-server/tools/wrk-perf/">
    
    <meta name="author" content="Steve Hu">
    

    <meta property="og:url" content="https://networknt.github.io/undertow-server/tools/wrk-perf/">
    <meta property="og:title" content="Undertow Server - The fastest Java API Framework">
    <meta property="og:image" content="https://networknt.github.io/undertow-server/images/logo.png">
    <meta name="apple-mobile-web-app-title" content="Undertow Server - The fastest Java API Framework">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <link rel="shortcut icon" type="image/x-icon" href="https://networknt.github.io/undertow-server/images/favicon.ico">
    <link rel="icon" type="image/x-icon" href="https://networknt.github.io/undertow-server/images/favicon.ico">

    <style>
      @font-face {
        font-family: 'Icon';
        src: url('https://networknt.github.io/undertow-server/fonts/icon.eot?52m981');
        src: url('https://networknt.github.io/undertow-server/fonts/icon.eot?#iefix52m981')
               format('embedded-opentype'),
             url('https://networknt.github.io/undertow-server/fonts/icon.woff?52m981')
               format('woff'),
             url('https://networknt.github.io/undertow-server/fonts/icon.ttf?52m981')
               format('truetype'),
             url('https://networknt.github.io/undertow-server/fonts/icon.svg?52m981#icon')
               format('svg');
        font-weight: normal;
        font-style: normal;
      }
    </style>

    <link rel="stylesheet" href="https://networknt.github.io/undertow-server/stylesheets/application.css">
    <link rel="stylesheet" href="https://networknt.github.io/undertow-server/stylesheets/temporary.css">
    <link rel="stylesheet" href="https://networknt.github.io/undertow-server/stylesheets/palettes.css">
    <link rel="stylesheet" href="https://networknt.github.io/undertow-server/stylesheets/highlight/highlight.css">

    
    
    
    <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Ubuntu:400,700|Ubuntu&#43;Mono">
    <style>
      body, input {
        font-family: 'Ubuntu', Helvetica, Arial, sans-serif;
      }
      pre, code {
        font-family: 'Ubuntu Mono', 'Courier New', 'Courier', monospace;
      }
    </style>

    
    <script src="https://networknt.github.io/undertow-server/javascripts/modernizr.js"></script>

    

  </head>
  <body class="palette-primary-red palette-accent-teal">



	
	


<div class="backdrop">
	<div class="backdrop-paper"></div>
</div>

<input class="toggle" type="checkbox" id="toggle-drawer">
<input class="toggle" type="checkbox" id="toggle-search">
<label class="toggle-button overlay" for="toggle-drawer"></label>

<header class="header">
	<nav aria-label="Header">
  <div class="bar default">
    <div class="button button-menu" role="button" aria-label="Menu">
      <label class="toggle-button icon icon-menu" for="toggle-drawer">
        <span></span>
      </label>
    </div>
    <div class="stretch">
      <div class="title">
        wrk performance test
      </div>
    </div>

    

    
    <div class="button button-github" role="button" aria-label="GitHub">
      <a href="https://github.com/stevehu" title="@stevehu on GitHub" target="_blank" class="toggle-button icon icon-github"></a>
    </div>
    
    
        
  </div>
  <div class="bar search">
    <div class="button button-close" role="button" aria-label="Close">
      <label class="toggle-button icon icon-back" for="toggle-search"></label>
    </div>
    <div class="stretch">
      <div class="field">
        <input class="query" type="text" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck>
      </div>
    </div>
    <div class="button button-reset" role="button" aria-label="Search">
      <button class="toggle-button icon icon-close" id="reset-search"></button>
    </div>
  </div>
</nav>
</header>

<main class="main">
	<div class="drawer">
		<nav aria-label="Navigation">
  <a href="https://github.com/networknt/undertow-server" class="project">
    <div class="banner">
      
        <div class="logo">
          <img src="https://networknt.github.io/undertow-server/images/logo.png">
        </div>
      
      <div class="name">
        <strong>Undertow Server - The fastest Java API Framework <span class="version">0.1.7</span></strong>
        
          <br>
          networknt/undertow-server
        
      </div>
    </div>
  </a>

  <div class="scrollable">
    <div class="wrapper">
      
        <ul class="repo">
          <li class="repo-download">
            <a href="https://github.com/networknt/undertow-server/archive/master.zip" target="_blank" title="Download" data-action="download">
              <i class="icon icon-download"></i> Download
            </a>
          </li>
          <li class="repo-stars">
            <a href="https://github.com/networknt/undertow-server/stargazers" target="_blank" title="Stargazers" data-action="star">
              <i class="icon icon-star"></i> Stars
              <span class="count">&ndash;</span>
            </a>
          </li>
        </ul>
        <hr>
      

      <div class="toc">
        
        <ul>
          




<li>
  
    



<a  title="Introduction" href="https://networknt.github.io/undertow-server/index.html">
	
	Introduction
</a>



  
</li>



<li>
  
    



<a  title="Getting started" href="https://networknt.github.io/undertow-server/getting-started/">
	
	Getting started
</a>



  
</li>



<li>
  
    



<a  title="Architecture" href="https://networknt.github.io/undertow-server/architecture/">
	
	Architecture
</a>



  
</li>



<li>
  
    



<a  title="Middleware" href="https://networknt.github.io/undertow-server/middleware/">
	
	Middleware
</a>



  
</li>



<li>
  
    



<a  title="Other Components" href="https://networknt.github.io/undertow-server/other-components/">
	
	Other Components
</a>



  
</li>



<li>
  
    



<a  title="Tutorials" href="https://networknt.github.io/undertow-server/tutorials/">
	
	Tutorials
</a>



  
</li>



<li>
  
    



<a  title="Tools" href="https://networknt.github.io/undertow-server/tools/">
	
	Tools
</a>



  
</li>



<li>
  
    



<a  title="Issues &amp; Help" href="https://github.com/networknt/undertow-server/issues">
	
	Issues &amp; Help
</a>



  
</li>



<li>
  
    



<a  title="Roadmap" href="https://networknt.github.io/undertow-server/roadmap/">
	
	Roadmap
</a>



  
</li>



<li>
  
    



<a  title="License" href="https://networknt.github.io/undertow-server/license/">
	
	License
</a>



  
</li>


        </ul>
        

        
        <hr>
        <span class="section">The author</span>
        
        <ul>
          

          
          <li>
            <a href="https://github.com/stevehu" target="_blank" title="@stevehu on GitHub">
              @stevehu on GitHub
            </a>
          </li>
          

          
          <li>
            <a href="mailto:stevehu@gmail.com" title="Email of stevehu@gmail.com">
              Contact via email
            </a>
          </li>
          
        </ul>
        
      </div>
    </div>
  </div>
</nav>

	</div>

	<article class="article">
		<div class="wrapper">
			<h1>wrk performance test </h1>

			

<h2 id="introduction">Introduction</h2>

<p>For most API frameworks in Java, the server can only handle up to ten thousands request per second and Apache JMeter
or Apache Bench will do the job. However, when we are talking about millions requests per second undertow-server
handles, they won&rsquo;t work as these tools will use up all the cpu resources. For high performance testing,
<a href="https://github.com/wg/wrk">wrk</a> is the best as it can send tens of millions requests per seconds on a
commodity hardware.</p>

<p>Another limitation on high performance throughput test is network limitation. Unless you client and server a connected
with 10G network, chances are the network will be the bottle net and you cannot reach the full handling potential of
you http server. To work around it, most of my tests are running on the same computer in order to gauge the raw server
throughput and latency.</p>

<h2 id="installation">Installation</h2>

<p><a href="https://github.com/wg/wrk/wiki/Installing-Wrk-on-Linux">Install on Linux</a></p>

<p><a href="https://github.com/wg/wrk/wiki/Installing-wrk-on-OSX">Install on Mac</a></p>

<h2 id="usage">Usage</h2>

<h3 id="basic">Basic</h3>

<pre><code>wrk -t12 -c400 -d30s http://localhost:8080/

</code></pre>

<p>12 threads</p>

<p>400 concurrent connections</p>

<p>30 seconds duration</p>

<h3 id="pipeline">Pipeline</h3>

<p>If you want to bump up number of requests, use pipeline</p>

<pre><code>wrk -t4 -c128 -d30s http://localhost:8080 -s pipeline.lua --latency -- / 16
</code></pre>

<p>Here is the pipeline.lua script</p>

<pre><code>init = function(args)
   request_uri = args[1]
   depth = tonumber(args[2]) or 1

   local r = {}
   for i=1,depth do
     r[i] = wrk.format(nil, request_uri)
   end
   req = table.concat(r)
end

request = function()
   return req
end
</code></pre>

<h3 id="debug">Debug</h3>

<p>If your wrk with pipeline.lua is not working or returning non 2XX or 3XX code, chances are you are using the wrong request
path after &ndash;. The default in the previous command is / and it should be changed to something like /v1/data for APIs.</p>

<p>In order to debug the pipeline.lua, use the following copy pipeline_debug.lua</p>

<pre><code>init = function(args)
   request_uri = args[1]
   depth = tonumber(args[2]) or 1

   local r = {}
   for i=1,depth do
     r[i] = wrk.format(nil, request_uri)
   end
   req = table.concat(r)
end

request = function()
   return req
end

response = function (status, headers, body)
  io.write(&quot;------------------------------\n&quot;)
  io.write(&quot;Response with status: &quot;.. status ..&quot;\n&quot;)
  io.write(&quot;------------------------------\n&quot;)

  io.write(&quot;[response] Body:\n&quot;)
  io.write(body .. &quot;\n&quot;)
end
</code></pre>

<h2 id="example">Example</h2>

<p>For some output examples, you can find at <a href="https://github.com/networknt/undertow-server-example/tree/master/performance">undertow-server-example/performance</a></p>

<h2 id="additional-info">Additional Info</h2>

<p>There are two other <a href="https://www.digitalocean.com/community/tutorials/how-to-benchmark-http-latency-with-wrk-on-ubuntu-14-04">tutorial 1</a>
and <a href="http://czerasz.com/2015/07/19/wrk-http-benchmarking-tool-example/">tutorial 2</a> for wrk written by Michal Czeraszkiewicz</p>


			<aside class="copyright" role="note">
				
				&copy; 2016 Released under the MIT license &ndash;
				
				Documentation built with
				<a href="https://www.gohugo.io" target="_blank">Hugo</a>
				using the
				<a href="http://github.com/digitalcraftsman/hugo-material-docs" target="_blank">Material</a> theme.
			</aside>

			<footer class="footer">
				

<nav class="pagination" aria-label="Footer">
  <div class="previous">
  
      <a href="https://networknt.github.io/undertow-server/tools/swagger-editor/" title="Swagger Editor for OpenAPI Specification">
        <span class="direction">
          Previous
        </span>
        <div class="page">
          <div class="button button-previous" role="button" aria-label="Previous">
            <i class="icon icon-back"></i>
          </div>
          <div class="stretch">
            <div class="title">
              Swagger Editor for OpenAPI Specification
            </div>
          </div>
        </div>
      </a>
  
  </div>

  <div class="next">
  
      <a href="https://networknt.github.io/undertow-server/tools/hugo-docs/" title="Hugo for project documentation on github">
        <span class="direction">
          Next
        </span>
        <div class="page">
          <div class="stretch">
            <div class="title">
              Hugo for project documentation on github
            </div>
          </div>
          <div class="button button-next" role="button" aria-label="Next">
            <i class="icon icon-forward"></i>
          </div>
        </div>
      </a>
  
  </div>
</nav>





			</footer>
		</div>
	</article>

	<div class="results" role="status" aria-live="polite">
		<div class="scrollable">
			<div class="wrapper">
				<div class="meta"></div>
				<div class="list"></div>
			</div>
		</div>
	</div>
</main>

    <script>
    
      var base_url = 'https:\/\/networknt.github.io\/undertow-server\/';
      var repo_id  = 'networknt\/undertow-server';
    
    </script>

    <script src="https://networknt.github.io/undertow-server/javascripts/application.js"></script>
    

    <script>
      /* Add headers to scrollspy */
      var headers   = document.getElementsByTagName("h2");
      var scrollspy = document.getElementById('scrollspy');

      if(scrollspy) {
        if(headers.length > 0) {
          for(var i = 0; i < headers.length; i++) {
            var li = document.createElement("li");
            li.setAttribute("class", "anchor");

            var a  = document.createElement("a");
            a.setAttribute("href", "#" + headers[i].id);
            a.setAttribute("title", headers[i].innerHTML);
            a.innerHTML = headers[i].innerHTML;
            
            li.appendChild(a)
            scrollspy.appendChild(li);
          }
        } else {
          scrollspy.parentElement.removeChild(scrollspy)
        }
        

        /* Add permanent link next to the headers */
        var headers = document.querySelectorAll("h1, h2, h3, h4, h5, h6");

        for(var i = 0; i < headers.length; i++) {
            var a = document.createElement("a");
            a.setAttribute("class", "headerlink");
            a.setAttribute("href", "#" + headers[i].id);
            a.setAttribute("title", "Permanent link")
            a.innerHTML = "#";
            headers[i].appendChild(a);
        }
      }
    </script>

    

    <script src="//gohugo.io/js/highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
  </body>
</html>
