<!DOCTYPE html>
  
  
  
  
   <html class="no-js"> 

  <head lang="en-us">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1,maximum-scale=1">
    <meta http-equiv="X-UA-Compatible" content="IE=10" />
    <title>Transaction management in microservices architecture - Light 4J - A fast, lightweight Java microservices framework</title>
    <meta name="generator" content="Hugo 0.20.6" />

    
    <meta name="description" content="Light 4J Docs">
    
    <link rel="canonical" href="https://networknt.github.io/light-4j/architecture/transaction/">
    
    <meta name="author" content="Steve Hu">
    

    <meta property="og:url" content="https://networknt.github.io/light-4j/architecture/transaction/">
    <meta property="og:title" content="Light 4J - A fast, lightweight Java microservices framework">
    <meta property="og:image" content="https://networknt.github.io/light-4j/images/logo.png">
    <meta name="apple-mobile-web-app-title" content="Light 4J - A fast, lightweight Java microservices framework">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <link rel="shortcut icon" type="image/x-icon" href="https://networknt.github.io/light-4j/images/favicon.ico">
    <link rel="icon" type="image/x-icon" href="https://networknt.github.io/light-4j/images/favicon.ico">

    <style>
      @font-face {
        font-family: 'Icon';
        src: url('https://networknt.github.io/light-4j/fonts/icon.eot');
        src: url('https://networknt.github.io/light-4j/fonts/icon.eot')
               format('embedded-opentype'),
             url('https://networknt.github.io/light-4j/fonts/icon.woff')
               format('woff'),
             url('https://networknt.github.io/light-4j/fonts/icon.ttf')
               format('truetype'),
             url('https://networknt.github.io/light-4j/fonts/icon.svg')
               format('svg');
        font-weight: normal;
        font-style: normal;
      }
    </style>

    <link rel="stylesheet" href="https://networknt.github.io/light-4j/stylesheets/application.css">
    <link rel="stylesheet" href="https://networknt.github.io/light-4j/stylesheets/temporary.css">
    <link rel="stylesheet" href="https://networknt.github.io/light-4j/stylesheets/palettes.css">
    <link rel="stylesheet" href="https://networknt.github.io/light-4j/stylesheets/highlight/highlight.css">

    
    
    
    <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Ubuntu:400,700|Ubuntu&#43;Mono">
    <style>
      body, input {
        font-family: 'Ubuntu', Helvetica, Arial, sans-serif;
      }
      pre, code {
        font-family: 'Ubuntu Mono', 'Courier New', 'Courier', monospace;
      }
    </style>

    
    <script src="https://networknt.github.io/light-4j/javascripts/modernizr.js"></script>

    

  </head>
  <body class="palette-primary-red palette-accent-teal">



	
	


<div class="backdrop">
	<div class="backdrop-paper"></div>
</div>

<input class="toggle" type="checkbox" id="toggle-drawer">
<input class="toggle" type="checkbox" id="toggle-search">
<label class="toggle-button overlay" for="toggle-drawer"></label>

<header class="header">
	<nav aria-label="Header">
  <div class="bar default">
    <div class="button button-menu" role="button" aria-label="Menu">
      <label class="toggle-button icon icon-menu" for="toggle-drawer">
        <span></span>
      </label>
    </div>
    <div class="stretch">
      <div class="title">
        Transaction management in microservices architecture
      </div>
    </div>

    

    
    <div class="button button-github" role="button" aria-label="GitHub">
      <a href="https://github.com/stevehu" title="@stevehu on GitHub" target="_blank" class="toggle-button icon icon-github"></a>
    </div>
    
    
        
  </div>
  <div class="bar search">
    <div class="button button-close" role="button" aria-label="Close">
      <label class="toggle-button icon icon-back" for="toggle-search"></label>
    </div>
    <div class="stretch">
      <div class="field">
        <input class="query" type="text" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck>
      </div>
    </div>
    <div class="button button-reset" role="button" aria-label="Search">
      <button class="toggle-button icon icon-close" id="reset-search"></button>
    </div>
  </div>
</nav>
</header>

<main class="main">
	<div class="drawer">
		<nav aria-label="Navigation">
  <a href="https://github.com/networknt/light-4j" class="project">
    <div class="banner">
      
        <div class="logo">
          <img src="https://networknt.github.io/light-4j/images/logo.png">
        </div>
      
      <div class="name">
        <strong>Light 4J - A fast, lightweight Java microservices framework <span class="version">1.4.4</span></strong>
        
          <br>
          networknt/light-4j
        
      </div>
    </div>
  </a>

  <div class="scrollable">
    <div class="wrapper">
      
        <ul class="repo">
          <li class="repo-download">
            <a href="https://github.com/networknt/light-4j/archive/master.zip" target="_blank" title="Download" data-action="download">
              <i class="icon icon-download"></i> Download
            </a>
          </li>
          <li class="repo-stars">
            <a href="https://github.com/networknt/light-4j/stargazers" target="_blank" title="Stargazers" data-action="star">
              <i class="icon icon-star"></i> Stars
              <span class="count">&ndash;</span>
            </a>
          </li>
        </ul>
        <hr>
      

      <div class="toc">
        
        <ul>
          




<li>
  
    



<a  title="Getting started" href="https://networknt.github.io/light-4j/getting-started/">
	
	Getting started
</a>



  
</li>



<li>
  
    



<a  title="Architecture" href="https://networknt.github.io/light-4j/architecture/">
	
	Architecture
</a>



  
</li>



<li>
  
    



<a  title="Design" href="https://networknt.github.io/light-4j/design/">
	
	Design
</a>



  
</li>



<li>
  
    



<a  title="Middleware" href="https://networknt.github.io/light-4j/middleware/">
	
	Middleware
</a>



  
</li>



<li>
  
    



<a  title="Other Components" href="https://networknt.github.io/light-4j/other/">
	
	Other Components
</a>



  
</li>



<li>
  
    



<a  title="DevOps" href="https://networknt.github.io/light-4j/devops/">
	
	DevOps
</a>



  
</li>



<li>
  
    



<a  title="Benchmarks" href="https://networknt.github.io/light-4j/benchmarks/">
	
	Benchmarks
</a>



  
</li>



<li>
  
    



<a  title="Tutorials" href="https://networknt.github.io/light-4j/tutorials/">
	
	Tutorials
</a>



  
</li>



<li>
  
    



<a  title="Examples" href="https://networknt.github.io/light-4j/example/">
	
	Examples
</a>



  
</li>



<li>
  
    



<a  title="Tools" href="https://networknt.github.io/light-4j/tools/">
	
	Tools
</a>



  
</li>



<li>
  
    



<a  title="Issues &amp; Help" href="https://github.com/networknt/light-4j/issues">
	
	Issues &amp; Help
</a>



  
</li>



<li>
  
    



<a  title="Roadmap" href="https://networknt.github.io/light-4j/roadmap/">
	
	Roadmap
</a>



  
</li>



<li>
  
    



<a  title="FAQ" href="https://networknt.github.io/light-4j/faq/">
	
	FAQ
</a>



  
</li>



<li>
  
    



<a  title="License" href="https://www.apache.org/licenses/LICENSE-2.0">
	
	License
</a>



  
</li>



<li>
  
    



<a  title="Introduction" href="https://networknt.github.io/light-4j/index.html">
	
	Introduction
</a>



  
</li>


        </ul>
        

        
        <hr>
        <span class="section">The author</span>
        
        <ul>
          

          
          <li>
            <a href="https://github.com/stevehu" target="_blank" title="@stevehu on GitHub">
              @stevehu on GitHub
            </a>
          </li>
          

          
          <li>
            <a href="mailto:stevehu@gmail.com" title="Email of stevehu@gmail.com">
              Contact via email
            </a>
          </li>
          
        </ul>
        
      </div>
    </div>
  </div>
</nav>

	</div>

	<article class="article">
		<div class="wrapper">
			<h1>Transaction management in microservices architecture </h1>

			

<p>In traditional monolithic applications, we normally use distributed transactions(<a href="https://en.wikipedia.org/wiki/X/Open_XA">XA</a>)
and two-phase commit(<a href="https://en.wikipedia.org/wiki/Two-phase_commit_protocol">2PC</a>)
to maintain data consistency and integrity.</p>

<p>After moving to microservices architecture, we don&rsquo;t have the option to use
XA correctly technically; however, a lot of developer will use it implicitly
without knowing the risk. In fact, they don&rsquo;t even realize that they are using
distributed transactions between microservices.</p>

<h2 id="what-is-a-distributed-transaction">What is a distributed transaction</h2>

<p>When we are talking about distributed transaction in monolithic world, we are
talking about explicit distributed transactions. In microservices architecture
people will not use explicit distributed transactions but they can use implicit
distributed transactions if they are not very careful.</p>

<p>Graham Lea defines distributed transaction in his article - <a href="http://www.grahamlea.com/2016/08/distributed-transactions-microservices-icebergs/">Distributed Transactions: The Icebergs of Microservices</a>
as:</p>

<p>Distributed transaction - any situation where a single event results in the
mutation of two or more separate sources of data which cannot be committed
atomically.</p>

<h2 id="risk-of-distributed-transactions-in-microservices">Risk of distributed transactions in microservices</h2>

<p>A lot of developers use implicit distributed transactions between multiple
microservices and it works most of time until one day there is a small network
glitch and the data of your application is messed up as the application designer
only thinks about happy path.</p>

<p>This happens when one command from UI triggers two or more microservices to
update their states. If everything is perfect, all updates will be successful
and everybody is happy. But what about the first service update is succeeded and
the second failed due to network issue? Is this acceptable in your business? The
majority of business people will answer no to this question.</p>

<p>So given we are doing microservices, how do we resolve the data consistency issue
between services. There are solutions based on how these services interact with
each other.</p>

<h2 id="solution-request-response">Solution - request/response</h2>

<p>When service to service communication is synchronous, the options are very limited.
Graham Lea documented some solution in his article and I have written some related
article before.</p>

<ul>
<li><a href="https://networknt.github.io/light-4j/design/idempotency/">Idempotency of Microservices</a></li>
<li><a href="https://networknt.github.io/light-4j/design/partial-failure/">How to handler partial failure</a></li>
</ul>

<h2 id="solution-event-based">Solution - event based</h2>

<p>A microservices architecture promotes availability over consistency, hence leveraging
a distributed transaction coordinator with a two-phase commit protocol is usually not
an option. It gets even more complicated with the idea that these loosely-coupled data
repositories might not necessarily all be relational stores and could be a polyglot
with a mix of relational and non-relational data stores. The idea of having an immediately
consistent state is difficult. What you should look forward to, however, is an architecture
that promotes eventual consistency like CQRS and Event Sourcing. An event driven architecture
can support a BASE (basic availability, soft-state, and eventual consistency) transaction
model. This is a great technique to solve the problem of handling transactions across
services and customers can be convinced to negotiate the contract towards a BASE model since
usually transactional consistency across functional boundaries is mostly about frequent
change of states, and consistency rules can be relaxed to let the final state be eventually
visible to the consumers.</p>

<p>To enable developer to use event driven approach for service to service communication, we
have provide <a href="https://github.com/networknt/light-eventuate-4j">light-eventuate-4j</a> framework
that support Event Sourcing and CQRS with Kafka as event broker. You can build your service
with light-rest-4j, light-graphql-4j or light-hybrid-4j. They will communicate with each
other asynchronously with events and eventually the states of each services will be consistent.</p>

<h2 id="xa-in-one-service">XA in one service</h2>

<p>Above we&rsquo;ve talked about transactions across multiple microserivces. How about XA transaction
in one service? For example, in one service, it updates two different databases at in one
transaction or updates one database and push a message into MQ queue in the same transaction.</p>

<p>In general, it is OK to use XA in one service and for light-*-4j frameworks, you can use a
third party library to manage XA transaction even we are not on Java EE platform.</p>

<p><a href="https://www.atomikos.com/Main/TransactionsEssentials">Transactions Essentials</a>
is an open source transaction manager and it is free.</p>

<p>Although it is doable with a Java SE JTA/XA transaction manager, it is not scaling at all.
For high performance microservices, it would be better to adapt eventual consistency instead.</p>

<p>When discussing transaction between multiple microservices, light-eventuate-4j is recommended
to be used to resolve data consistency between services. In one service, it is still can be
used to eliminate the needs for XA transaction.</p>

<h2 id="complex-business-transaction">Complex business transaction</h2>

<p>For complex business transactions, only eventual consistency is not enough and Saga pattern
would be used to ensure that partial of services can be rollback with compensation steps if one
of the services fails.</p>

<p>Our saga implementation is still working in progress and here is an <a href="https://blog.bernd-ruecker.com/saga-how-to-implement-complex-business-transactions-without-two-phase-commit-e00aa41a1b1b">article</a>
explain it very good.</p>


			<aside class="copyright" role="note">
				
				&copy; 2017 Released under the MIT license &ndash;
				
				Documentation built with
				<a href="https://www.gohugo.io" target="_blank">Hugo</a>
				using the
				<a href="http://github.com/digitalcraftsman/hugo-material-docs" target="_blank">Material</a> theme.
			</aside>

			<footer class="footer">
				

<nav class="pagination" aria-label="Footer">
  <div class="previous">
  
      <a href="https://networknt.github.io/light-4j/faq/" title="FAQ">
        <span class="direction">
          Previous
        </span>
        <div class="page">
          <div class="button button-previous" role="button" aria-label="Previous">
            <i class="icon icon-back"></i>
          </div>
          <div class="stretch">
            <div class="title">
              FAQ
            </div>
          </div>
        </div>
      </a>
  
  </div>

  <div class="next">
  
      <a href="https://networknt.github.io/light-4j/design/consumer-contract/" title="Consumer Contract and Consumer Driven Contract">
        <span class="direction">
          Next
        </span>
        <div class="page">
          <div class="stretch">
            <div class="title">
              Consumer Contract and Consumer Driven Contract
            </div>
          </div>
          <div class="button button-next" role="button" aria-label="Next">
            <i class="icon icon-forward"></i>
          </div>
        </div>
      </a>
  
  </div>
</nav>





			</footer>
		</div>
	</article>

	<div class="results" role="status" aria-live="polite">
		<div class="scrollable">
			<div class="wrapper">
				<div class="meta"></div>
				<div class="list"></div>
			</div>
		</div>
	</div>
</main>

    <script>
    
      var base_url = 'https:\/\/networknt.github.io\/light-4j\/';
      var repo_id  = 'networknt\/light-4j';
    
    </script>

    <script src="https://networknt.github.io/light-4j/javascripts/application.js"></script>
    

    <script>
      /* Add headers to scrollspy */
      var headers   = document.getElementsByTagName("h2");
      var scrollspy = document.getElementById('scrollspy');

      if(scrollspy) {
        if(headers.length > 0) {
          for(var i = 0; i < headers.length; i++) {
            var li = document.createElement("li");
            li.setAttribute("class", "anchor");

            var a  = document.createElement("a");
            a.setAttribute("href", "#" + headers[i].id);
            a.setAttribute("title", headers[i].innerHTML);
            a.innerHTML = headers[i].innerHTML;

            li.appendChild(a)
            scrollspy.appendChild(li);
          }
        } else {
          scrollspy.parentElement.removeChild(scrollspy)
        }


        /* Add permanent link next to the headers */
        var headers = document.querySelectorAll("h1, h2, h3, h4, h5, h6");

        for(var i = 0; i < headers.length; i++) {
            var a = document.createElement("a");
            a.setAttribute("class", "headerlink");
            a.setAttribute("href", "#" + headers[i].id);
            a.setAttribute("title", "Permanent link")
            a.innerHTML = "#";
            headers[i].appendChild(a);
        }
      }
    </script>

    

    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.8.0/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
  </body>
</html>

